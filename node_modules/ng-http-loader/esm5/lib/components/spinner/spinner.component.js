/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
/*
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
import { Component, Input } from '@angular/core';
import { EMPTY, merge, timer } from 'rxjs';
import { debounce, delayWhen } from 'rxjs/operators';
import { PendingInterceptorService } from '../../services/pending-interceptor.service';
import { SpinnerVisibilityService } from '../../services/spinner-visibility.service';
import { Spinkit } from '../../spinkits';
var SpinnerComponent = /** @class */ (function () {
    function SpinnerComponent(pendingInterceptorService, spinnerVisibilityService) {
        this.pendingInterceptorService = pendingInterceptorService;
        this.spinnerVisibilityService = spinnerVisibilityService;
        this.spinkit = Spinkit;
        this.spinner = Spinkit.skCubeGrid;
        this.filteredUrlPatterns = [];
        this.debounceDelay = 0;
        this.minDuration = 0;
        this.entryComponent = null;
        this.subscriptions = merge(this.pendingInterceptorService.pendingRequestsStatus$.pipe(debounce(this.handleDebounceDelay.bind(this)), delayWhen(this.handleMinDuration.bind(this))), this.spinnerVisibilityService.visibilityObservable$)
            .subscribe(this.handleSpinnerVisibility().bind(this));
    }
    /**
     * @return {?}
     */
    SpinnerComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.nullifySpinnerIfComponentOutletIsDefined();
        if (!(this.filteredUrlPatterns instanceof Array)) {
            throw new TypeError('`filteredUrlPatterns` must be an array.');
        }
        if (!!this.filteredUrlPatterns.length) {
            this.filteredUrlPatterns.forEach(function (e) {
                _this.pendingInterceptorService.filteredUrlPatterns.push(new RegExp(e));
            });
        }
    };
    /**
     * @return {?}
     */
    SpinnerComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.subscriptions.unsubscribe();
    };
    /**
     * @return {?}
     */
    SpinnerComponent.prototype.nullifySpinnerIfComponentOutletIsDefined = /**
     * @return {?}
     */
    function () {
        if (null != this.entryComponent) {
            this.spinner = null;
        }
    };
    /**
     * @return {?}
     */
    SpinnerComponent.prototype.handleSpinnerVisibility = /**
     * @return {?}
     */
    function () {
        var _this = this;
        return function (v) { return _this.isSpinnerVisible = v; };
    };
    /**
     * @param {?} hasPendingRequests
     * @return {?}
     */
    SpinnerComponent.prototype.handleDebounceDelay = /**
     * @param {?} hasPendingRequests
     * @return {?}
     */
    function (hasPendingRequests) {
        if (hasPendingRequests && !!this.debounceDelay) {
            return timer(this.debounceDelay);
        }
        return EMPTY;
    };
    /**
     * @param {?} hasPendingRequests
     * @return {?}
     */
    SpinnerComponent.prototype.handleMinDuration = /**
     * @param {?} hasPendingRequests
     * @return {?}
     */
    function (hasPendingRequests) {
        if (hasPendingRequests || !this.minDuration) {
            this.startTime = Date.now();
            return timer(0);
        }
        var /** @type {?} */ timerObservable = timer(this.minDuration - (Date.now() - this.startTime));
        this.startTime = null;
        return timerObservable;
    };
    SpinnerComponent.decorators = [
        { type: Component, args: [{
                    selector: 'spinner',
                    template: "<div id=\"spinner\" *ngIf=\"isSpinnerVisible\">\n\n    <ng-container *ngComponentOutlet=\"entryComponent\"></ng-container>\n\n    <sk-cube-grid\n        *ngIf=\"spinner === spinkit.skCubeGrid\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-cube-grid>\n\n    <sk-chasing-dots\n        *ngIf=\"spinner === spinkit.skChasingDots\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-chasing-dots>\n\n    <sk-double-bounce\n        *ngIf=\"spinner === spinkit.skDoubleBounce\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-double-bounce>\n\n    <sk-rotating-plane\n        *ngIf=\"spinner === spinkit.skRotatingPlane\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-rotating-plane>\n\n    <sk-spinner-pulse\n        *ngIf=\"spinner === spinkit.skSpinnerPulse\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-spinner-pulse>\n\n    <sk-three-bounce\n        *ngIf=\"spinner === spinkit.skThreeBounce\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-three-bounce>\n\n    <sk-wandering-cubes\n        *ngIf=\"spinner === spinkit.skWanderingCubes\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-wandering-cubes>\n\n    <sk-wave\n        *ngIf=\"spinner === spinkit.skWave\"\n        [backgroundColor]=\"backgroundColor\">\n    </sk-wave>\n\n</div>\n\n",
                    styles: ["#spinner{top:0;left:0;height:100%;width:100%;position:fixed;z-index:9999;opacity:.7;background-color:#f1f1f1;display:flex;align-items:center;justify-content:center}::ng-deep .colored-parent,::ng-deep .colored>div{background-color:#333}"]
                },] },
    ];
    /** @nocollapse */
    SpinnerComponent.ctorParameters = function () { return [
        { type: PendingInterceptorService, },
        { type: SpinnerVisibilityService, },
    ]; };
    SpinnerComponent.propDecorators = {
        "backgroundColor": [{ type: Input },],
        "spinner": [{ type: Input },],
        "filteredUrlPatterns": [{ type: Input },],
        "debounceDelay": [{ type: Input },],
        "minDuration": [{ type: Input },],
        "entryComponent": [{ type: Input },],
    };
    return SpinnerComponent;
}());
export { SpinnerComponent };
function SpinnerComponent_tsickle_Closure_declarations() {
    /** @type {!Array<{type: !Function, args: (undefined|!Array<?>)}>} */
    SpinnerComponent.decorators;
    /**
     * @nocollapse
     * @type {function(): !Array<(null|{type: ?, decorators: (undefined|!Array<{type: !Function, args: (undefined|!Array<?>)}>)})>}
     */
    SpinnerComponent.ctorParameters;
    /** @type {!Object<string,!Array<{type: !Function, args: (undefined|!Array<?>)}>>} */
    SpinnerComponent.propDecorators;
    /** @type {?} */
    SpinnerComponent.prototype.isSpinnerVisible;
    /** @type {?} */
    SpinnerComponent.prototype.spinkit;
    /** @type {?} */
    SpinnerComponent.prototype.subscriptions;
    /** @type {?} */
    SpinnerComponent.prototype.startTime;
    /** @type {?} */
    SpinnerComponent.prototype.backgroundColor;
    /** @type {?} */
    SpinnerComponent.prototype.spinner;
    /** @type {?} */
    SpinnerComponent.prototype.filteredUrlPatterns;
    /** @type {?} */
    SpinnerComponent.prototype.debounceDelay;
    /** @type {?} */
    SpinnerComponent.prototype.minDuration;
    /** @type {?} */
    SpinnerComponent.prototype.entryComponent;
    /** @type {?} */
    SpinnerComponent.prototype.pendingInterceptorService;
    /** @type {?} */
    SpinnerComponent.prototype.spinnerVisibilityService;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3Bpbm5lci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1odHRwLWxvYWRlci8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3NwaW5uZXIvc3Bpbm5lci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBU0EsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQXFCLE1BQU0sZUFBZSxDQUFDO0FBQ3BFLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUE0QixLQUFLLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDckUsT0FBTyxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSw0Q0FBNEMsQ0FBQztBQUN2RixPQUFPLEVBQUUsd0JBQXdCLEVBQUUsTUFBTSwyQ0FBMkMsQ0FBQztBQUNyRixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7O0lBd0VyQywwQkFBb0IseUJBQW9ELEVBQVUsd0JBQWtEO1FBQWhILDhCQUF5QixHQUF6Qix5QkFBeUIsQ0FBMkI7UUFBVSw2QkFBd0IsR0FBeEIsd0JBQXdCLENBQTBCO3VCQWpCbkgsT0FBTzt1QkFPUCxPQUFPLENBQUMsVUFBVTttQ0FFSSxFQUFFOzZCQUVsQixDQUFDOzJCQUVILENBQUM7OEJBRU8sSUFBSTtRQUc3QixJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FDdEIsSUFBSSxDQUFDLHlCQUF5QixDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FDdEQsUUFBUSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsRUFDN0MsU0FBUyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FDL0MsRUFDRCxJQUFJLENBQUMsd0JBQXdCLENBQUMscUJBQXFCLENBQ3REO2FBQ0ksU0FBUyxDQUFDLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0tBQzdEOzs7O0lBRUQsbUNBQVE7OztJQUFSO1FBQUEsaUJBWUM7UUFYRyxJQUFJLENBQUMsd0NBQXdDLEVBQUUsQ0FBQztRQUVoRCxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQyxNQUFNLElBQUksU0FBUyxDQUFDLHlDQUF5QyxDQUFDLENBQUM7U0FDbEU7UUFFRCxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDcEMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUM7Z0JBQzlCLEtBQUksQ0FBQyx5QkFBeUIsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUMxRSxDQUFDLENBQUM7U0FDTjtLQUNKOzs7O0lBRUQsc0NBQVc7OztJQUFYO1FBQ0ksSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztLQUNwQzs7OztJQUVPLG1FQUF3Qzs7OztRQUM1QyxFQUFFLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7WUFDOUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7U0FDdkI7Ozs7O0lBR0csa0RBQXVCOzs7OztRQUMzQixNQUFNLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxLQUFJLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxFQUF6QixDQUF5QixDQUFDOzs7Ozs7SUFHbEMsOENBQW1COzs7O2NBQUMsa0JBQTJCO1FBQ25ELEVBQUUsQ0FBQyxDQUFDLGtCQUFrQixJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztZQUM3QyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztTQUNwQztRQUVELE1BQU0sQ0FBQyxLQUFLLENBQUM7Ozs7OztJQUdULDRDQUFpQjs7OztjQUFDLGtCQUEyQjtRQUNqRCxFQUFFLENBQUMsQ0FBQyxrQkFBa0IsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQzFDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBRTVCLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDbkI7UUFFRCxxQkFBTSxlQUFlLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDaEYsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7UUFFdEIsTUFBTSxDQUFDLGVBQWUsQ0FBQzs7O2dCQS9IOUIsU0FBUyxTQUFDO29CQUNQLFFBQVEsRUFBRSxTQUFTO29CQUNuQixRQUFRLEVBQUUsdXlDQThDYjtvQkFDRyxNQUFNLEVBQUUsQ0FBQyw2T0FBNk8sQ0FBQztpQkFDMVA7Ozs7Z0JBdERRLHlCQUF5QjtnQkFDekIsd0JBQXdCOzs7b0NBNEQ1QixLQUFLOzRCQUVMLEtBQUs7d0NBRUwsS0FBSztrQ0FFTCxLQUFLO2dDQUVMLEtBQUs7bUNBRUwsS0FBSzs7MkJBbkZWOztTQW1FYSxnQkFBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuICogSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1NcbiAqIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUlxuICogQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSXG4gKiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTlxuICogQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS5cbiAqL1xuXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRU1QVFksIG1lcmdlLCBPYnNlcnZhYmxlLCBTdWJzY3JpcHRpb24sIHRpbWVyIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkZWJvdW5jZSwgZGVsYXlXaGVuIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgUGVuZGluZ0ludGVyY2VwdG9yU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL3BlbmRpbmctaW50ZXJjZXB0b3Iuc2VydmljZSc7XG5pbXBvcnQgeyBTcGlubmVyVmlzaWJpbGl0eVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2aWNlcy9zcGlubmVyLXZpc2liaWxpdHkuc2VydmljZSc7XG5pbXBvcnQgeyBTcGlua2l0IH0gZnJvbSAnLi4vLi4vc3BpbmtpdHMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ3NwaW5uZXInLFxuICAgIHRlbXBsYXRlOiBgPGRpdiBpZD1cInNwaW5uZXJcIiAqbmdJZj1cImlzU3Bpbm5lclZpc2libGVcIj5cblxuICAgIDxuZy1jb250YWluZXIgKm5nQ29tcG9uZW50T3V0bGV0PVwiZW50cnlDb21wb25lbnRcIj48L25nLWNvbnRhaW5lcj5cblxuICAgIDxzay1jdWJlLWdyaWRcbiAgICAgICAgKm5nSWY9XCJzcGlubmVyID09PSBzcGlua2l0LnNrQ3ViZUdyaWRcIlxuICAgICAgICBbYmFja2dyb3VuZENvbG9yXT1cImJhY2tncm91bmRDb2xvclwiPlxuICAgIDwvc2stY3ViZS1ncmlkPlxuXG4gICAgPHNrLWNoYXNpbmctZG90c1xuICAgICAgICAqbmdJZj1cInNwaW5uZXIgPT09IHNwaW5raXQuc2tDaGFzaW5nRG90c1wiXG4gICAgICAgIFtiYWNrZ3JvdW5kQ29sb3JdPVwiYmFja2dyb3VuZENvbG9yXCI+XG4gICAgPC9zay1jaGFzaW5nLWRvdHM+XG5cbiAgICA8c2stZG91YmxlLWJvdW5jZVxuICAgICAgICAqbmdJZj1cInNwaW5uZXIgPT09IHNwaW5raXQuc2tEb3VibGVCb3VuY2VcIlxuICAgICAgICBbYmFja2dyb3VuZENvbG9yXT1cImJhY2tncm91bmRDb2xvclwiPlxuICAgIDwvc2stZG91YmxlLWJvdW5jZT5cblxuICAgIDxzay1yb3RhdGluZy1wbGFuZVxuICAgICAgICAqbmdJZj1cInNwaW5uZXIgPT09IHNwaW5raXQuc2tSb3RhdGluZ1BsYW5lXCJcbiAgICAgICAgW2JhY2tncm91bmRDb2xvcl09XCJiYWNrZ3JvdW5kQ29sb3JcIj5cbiAgICA8L3NrLXJvdGF0aW5nLXBsYW5lPlxuXG4gICAgPHNrLXNwaW5uZXItcHVsc2VcbiAgICAgICAgKm5nSWY9XCJzcGlubmVyID09PSBzcGlua2l0LnNrU3Bpbm5lclB1bHNlXCJcbiAgICAgICAgW2JhY2tncm91bmRDb2xvcl09XCJiYWNrZ3JvdW5kQ29sb3JcIj5cbiAgICA8L3NrLXNwaW5uZXItcHVsc2U+XG5cbiAgICA8c2stdGhyZWUtYm91bmNlXG4gICAgICAgICpuZ0lmPVwic3Bpbm5lciA9PT0gc3BpbmtpdC5za1RocmVlQm91bmNlXCJcbiAgICAgICAgW2JhY2tncm91bmRDb2xvcl09XCJiYWNrZ3JvdW5kQ29sb3JcIj5cbiAgICA8L3NrLXRocmVlLWJvdW5jZT5cblxuICAgIDxzay13YW5kZXJpbmctY3ViZXNcbiAgICAgICAgKm5nSWY9XCJzcGlubmVyID09PSBzcGlua2l0LnNrV2FuZGVyaW5nQ3ViZXNcIlxuICAgICAgICBbYmFja2dyb3VuZENvbG9yXT1cImJhY2tncm91bmRDb2xvclwiPlxuICAgIDwvc2std2FuZGVyaW5nLWN1YmVzPlxuXG4gICAgPHNrLXdhdmVcbiAgICAgICAgKm5nSWY9XCJzcGlubmVyID09PSBzcGlua2l0LnNrV2F2ZVwiXG4gICAgICAgIFtiYWNrZ3JvdW5kQ29sb3JdPVwiYmFja2dyb3VuZENvbG9yXCI+XG4gICAgPC9zay13YXZlPlxuXG48L2Rpdj5cblxuYCxcbiAgICBzdHlsZXM6IFtgI3NwaW5uZXJ7dG9wOjA7bGVmdDowO2hlaWdodDoxMDAlO3dpZHRoOjEwMCU7cG9zaXRpb246Zml4ZWQ7ei1pbmRleDo5OTk5O29wYWNpdHk6Ljc7YmFja2dyb3VuZC1jb2xvcjojZjFmMWYxO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcn06Om5nLWRlZXAgLmNvbG9yZWQtcGFyZW50LDo6bmctZGVlcCAuY29sb3JlZD5kaXZ7YmFja2dyb3VuZC1jb2xvcjojMzMzfWBdXG59KVxuZXhwb3J0IGNsYXNzIFNwaW5uZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3ksIE9uSW5pdCB7XG4gICAgcHVibGljIGlzU3Bpbm5lclZpc2libGU6IGJvb2xlYW47XG4gICAgcHVibGljIHNwaW5raXQgPSBTcGlua2l0O1xuICAgIHByaXZhdGUgc3Vic2NyaXB0aW9uczogU3Vic2NyaXB0aW9uO1xuICAgIHByaXZhdGUgc3RhcnRUaW1lOiBudW1iZXI7XG5cbiAgICBASW5wdXQoKVxuICAgIHB1YmxpYyBiYWNrZ3JvdW5kQ29sb3I6IHN0cmluZztcbiAgICBASW5wdXQoKVxuICAgIHB1YmxpYyBzcGlubmVyID0gU3BpbmtpdC5za0N1YmVHcmlkO1xuICAgIEBJbnB1dCgpXG4gICAgcHVibGljIGZpbHRlcmVkVXJsUGF0dGVybnM6IHN0cmluZ1tdID0gW107XG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgZGVib3VuY2VEZWxheSA9IDA7XG4gICAgQElucHV0KClcbiAgICBwdWJsaWMgbWluRHVyYXRpb24gPSAwO1xuICAgIEBJbnB1dCgpXG4gICAgcHVibGljIGVudHJ5Q29tcG9uZW50OiBhbnkgPSBudWxsO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBwZW5kaW5nSW50ZXJjZXB0b3JTZXJ2aWNlOiBQZW5kaW5nSW50ZXJjZXB0b3JTZXJ2aWNlLCBwcml2YXRlIHNwaW5uZXJWaXNpYmlsaXR5U2VydmljZTogU3Bpbm5lclZpc2liaWxpdHlTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IG1lcmdlKFxuICAgICAgICAgICAgdGhpcy5wZW5kaW5nSW50ZXJjZXB0b3JTZXJ2aWNlLnBlbmRpbmdSZXF1ZXN0c1N0YXR1cyQucGlwZShcbiAgICAgICAgICAgICAgICBkZWJvdW5jZSh0aGlzLmhhbmRsZURlYm91bmNlRGVsYXkuYmluZCh0aGlzKSksXG4gICAgICAgICAgICAgICAgZGVsYXlXaGVuKHRoaXMuaGFuZGxlTWluRHVyYXRpb24uYmluZCh0aGlzKSlcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICB0aGlzLnNwaW5uZXJWaXNpYmlsaXR5U2VydmljZS52aXNpYmlsaXR5T2JzZXJ2YWJsZSQsXG4gICAgICAgIClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUodGhpcy5oYW5kbGVTcGlubmVyVmlzaWJpbGl0eSgpLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCk6IHZvaWQge1xuICAgICAgICB0aGlzLm51bGxpZnlTcGlubmVySWZDb21wb25lbnRPdXRsZXRJc0RlZmluZWQoKTtcblxuICAgICAgICBpZiAoISh0aGlzLmZpbHRlcmVkVXJsUGF0dGVybnMgaW5zdGFuY2VvZiBBcnJheSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2BmaWx0ZXJlZFVybFBhdHRlcm5zYCBtdXN0IGJlIGFuIGFycmF5LicpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCEhdGhpcy5maWx0ZXJlZFVybFBhdHRlcm5zLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5maWx0ZXJlZFVybFBhdHRlcm5zLmZvckVhY2goZSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nSW50ZXJjZXB0b3JTZXJ2aWNlLmZpbHRlcmVkVXJsUGF0dGVybnMucHVzaChuZXcgUmVnRXhwKGUpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy51bnN1YnNjcmliZSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgbnVsbGlmeVNwaW5uZXJJZkNvbXBvbmVudE91dGxldElzRGVmaW5lZCgpOiB2b2lkIHtcbiAgICAgICAgaWYgKG51bGwgIT0gdGhpcy5lbnRyeUNvbXBvbmVudCkge1xuICAgICAgICAgICAgdGhpcy5zcGlubmVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlU3Bpbm5lclZpc2liaWxpdHkoKTogKHY6IGJvb2xlYW4pID0+IHZvaWQge1xuICAgICAgICByZXR1cm4gdiA9PiB0aGlzLmlzU3Bpbm5lclZpc2libGUgPSB2O1xuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlRGVib3VuY2VEZWxheShoYXNQZW5kaW5nUmVxdWVzdHM6IGJvb2xlYW4pOiBPYnNlcnZhYmxlPG51bWJlciB8IG5ldmVyPiB7XG4gICAgICAgIGlmIChoYXNQZW5kaW5nUmVxdWVzdHMgJiYgISF0aGlzLmRlYm91bmNlRGVsYXkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aW1lcih0aGlzLmRlYm91bmNlRGVsYXkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIEVNUFRZO1xuICAgIH1cblxuICAgIHByaXZhdGUgaGFuZGxlTWluRHVyYXRpb24oaGFzUGVuZGluZ1JlcXVlc3RzOiBib29sZWFuKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcbiAgICAgICAgaWYgKGhhc1BlbmRpbmdSZXF1ZXN0cyB8fCAhdGhpcy5taW5EdXJhdGlvbikge1xuICAgICAgICAgICAgdGhpcy5zdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgICAgICByZXR1cm4gdGltZXIoMCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB0aW1lck9ic2VydmFibGUgPSB0aW1lcih0aGlzLm1pbkR1cmF0aW9uIC0gKERhdGUubm93KCkgLSB0aGlzLnN0YXJ0VGltZSkpO1xuICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IG51bGw7XG5cbiAgICAgICAgcmV0dXJuIHRpbWVyT2JzZXJ2YWJsZTtcbiAgICB9XG59XG4iXX0=